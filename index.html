<!DOCTYPE html>
<html>

<head>
  <style>
    canvas {
      outline: 1px solid;
    }
  </style>
</head>

<body>
  <canvas id="canvas" width="1000" height="700">todo</canvas>

  <script>
    Object.defineProperty(Array.prototype, 'sortf', {
      value: function (sortSelector) {
        return [].concat(this).sort(function (one, two) {
          let selectedOne = sortSelector(one);
          let selectedTwo = sortSelector(two);

          return selectedOne - selectedTwo;
        });
      }
    });

    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext('2d');
    function getShape(radMin, radMax) {
      const colorOptions = ["#d2691e", '#deb887', 'black', '#556b2f', '#a9a9a9'];


      let numPoints = getRandomInt(4, 7);
      let paths = [];
      for (let i = 0; i < numPoints; i++) {
        paths.push({
          x: getRandomInt(-radMax, radMax),
          y: getRandomInt(-radMax, radMax),
        });
      }
      return {
        type: 'polygon',
        paths: paths,
        radius: (radMax + radMin) / 2,
        fillStyle: colorOptions[getRandomInt(0, colorOptions.length)],
        position: { x: getRandomInt(0, canvas.width), y: getRandomInt(0, canvas.height) }
      };

      return {
        type: 'circle',
        radius: getRandomInt(radMin, radMax),
        fillStyle: colorOptions[getRandomInt(0, colorOptions.length)],
        position: { x: getRandomInt(0, canvas.width), y: getRandomInt(0, canvas.height) }
      };
    }

    function drawShape(shape, ctx) {
      if (shape.type == 'circle') {
        ctx.beginPath();
        ctx.fillStyle = shape.fillStyle;
        ctx.arc(shape.position.x, shape.position.y, shape.radius, 0, Math.PI * 2, true);
        ctx.fill();
        ctx.beginPath();
        ctx.fillStyle = 'black';
        ctx.arc(shape.position.x, shape.position.y, shape.radius, 0, Math.PI * 2, true);
        ctx.stroke();
      } else if (shape.type == "polygon") {
        // sorting by angle from centerpoint inspired by - https://observablehq.com/@tarte0/generate-random-simple-polygon#sortedPoints
        let sortedPoints = shape.paths.sortf(item => {
          return Math.atan2(item.y, item.x) * 180 / Math.PI;
        });
        ctx.beginPath();
        ctx.fillStyle = shape.fillStyle;
        ctx.moveTo(sortedPoints[0].x + shape.position.x, sortedPoints[0].y + shape.position.y);
        sortedPoints.forEach(path => {
          ctx.lineTo(shape.position.x + path.x, shape.position.y + path.y);
        });
        ctx.fill();
      } else {
        throw `Unknown type ${shape.type}`;
      }

    }

    function distance(point1, point2) {
      return Math.sqrt(Math.pow((point1.x - point2.x), 2) + Math.pow((point1.y - point2.y), 2));
    }

    function generateShapes(existingShapes, number, minSize, maxSize) {
      if (number == 0) return [];
      if (minSize <= 1) return [];
      var result = [];
      let misses = 0;
      let placedShapes = 0;
      while (misses < number * 10 && placedShapes < number) {
        let potentialShape = getShape(minSize, maxSize);
        let collisions = result.filter(existing => collides(existing, potentialShape)).concat(existingShapes.filter(existing => collides(existing, potentialShape)));
        if (collisions.length == 0) {
          result.push(potentialShape);
          placedShapes++;
        } else {
          misses++;
        }
      }
      return result.concat(generateShapes(result.concat(existingShapes), number - placedShapes, minSize * .9, maxSize * .8));
    }

    function collides(shape1, shape2) {
      let d = distance(shape1.position, shape2.position);
      return d < shape1.radius + shape2.radius + 8;

    }

    function getRandomInt(min, max) {
      return min + Math.floor(Math.random() * (max - min));
    }

    let shapes = generateShapes([], 240, 20, 40);
    ctx.fillStyle = 'lightgray';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    shapes.forEach(shape => {
      drawShape(shape, ctx);
    });



  </script>
</body>

</html>